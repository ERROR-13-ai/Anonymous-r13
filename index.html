
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>⚠️ SISTEMA STARLINK HR13 - ACCESO RESTRINGIDO</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono:wght@400&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --matrix-green: #00ff41;
      --cyber-blue: #00d9ff;
      --warning-red: #ff0044;
      --neon-purple: #bf00ff;
      --bg-dark: #000008;
      --glitch-pink: #ff0080;
      --accent-orange: #ff8c00; /* Nuevo color de acento */
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      background: var(--bg-dark);
      font-family: 'Share Tech Mono', monospace;
      color: var(--matrix-green);
      overflow: hidden;
      cursor: none;
      text-rendering: optimizeLegibility; /* Mejor renderizado de fuentes */
    }

    /* Custom Cursor */
    .cursor {
      position: fixed;
      width: 20px;
      height: 20px;
      border: 2px solid var(--cyber-blue);
      border-radius: 50%;
      pointer-events: none;
      z-index: 9999;
      transition: all 0.1s ease;
      mix-blend-mode: difference;
      will-change: transform;
    }

    .cursor::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 4px;
      height: 4px;
      background: var(--cyber-blue);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 0.3; transform: translate(-50%, -50%) scale(1.5); }
    }

    /* Matrix Background */
    canvas#matrix {
      position: fixed;
      inset: 0;
      z-index: 1;
      will-change: contents; /* Para optimizar el renderizado del canvas */
    }

    /* Scan Line Effect */
    .scanline {
      position: fixed;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--cyber-blue), transparent);
      top: 0;
      z-index: 2;
      animation: scanline 3s linear infinite;
      opacity: 0.6;
      will-change: transform, opacity;
    }

    .scanline-2 {
      animation-delay: 1.5s;
      height: 1px;
      opacity: 0.4;
      background: linear-gradient(90deg, transparent, var(--matrix-green), transparent);
    }

    @keyframes scanline {
      0% { top: 0; transform: skewX(-5deg); }
      100% { top: 100%; transform: skewX(5deg); }
    }

    /* Main UI Container */
    .ui-container {
      position: relative;
      z-index: 10;
      width: 100%;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(ellipse at center, rgba(0,255,65,0.03) 0%, transparent 70%);
    }

    /* Welcome Overlay */
    #welcome-overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(45deg, rgba(0,0,8,0.95), rgba(0,20,40,0.95));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .welcome-title {
      font-family: 'Orbitron', monospace;
      font-size: 3.5rem;
      font-weight: 900;
      color: var(--cyber-blue);
      text-shadow: 0 0 20px var(--cyber-blue), 0 0 40px var(--cyber-blue);
      margin-bottom: 2rem;
      text-align: center;
      animation: titleGlow 2s ease-in-out infinite alternate;
    }

    @keyframes titleGlow {
      0% { text-shadow: 0 0 20px var(--cyber-blue), 0 0 40px var(--cyber-blue); }
      100% { text-shadow: 0 0 30px var(--cyber-blue), 0 0 60px var(--cyber-blue), 0 0 80px var(--cyber-blue); }
    }

    .start-btn {
      padding: 15px 40px;
      background: transparent;
      border: 2px solid var(--matrix-green);
      color: var(--matrix-green);
      font-family: 'Share Tech Mono', monospace;
      font-size: 1.2rem;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      will-change: transform, background, color, box-shadow;
    }

    .start-btn:hover {
      color: var(--bg-dark);
      background: var(--matrix-green);
      box-shadow: 0 0 30px var(--matrix-green);
      transform: scale(1.05);
    }

    .start-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .start-btn:hover::before {
      left: 100%;
    }

    /* Terminal Container */
    #terminal-container {
      display: none;
      width: 90%;
      max-width: 1200px;
      background: rgba(0,0,0,0.8);
      border: 1px solid var(--matrix-green);
      border-radius: 10px;
      padding: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 0 50px rgba(0,255,65,0.3);
      will-change: transform, opacity;
    }

    .terminal-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--matrix-green);
    }

    .terminal-dots {
      display: flex;
      gap: 8px;
      margin-right: 15px;
    }

    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .dot.red { background: var(--warning-red); }
    .dot.yellow { background: var(--accent-orange); } /* Usar nuevo color de acento */
    .dot.green { background: var(--matrix-green); }

    .terminal-title {
      font-family: 'Orbitron', monospace;
      font-weight: 700;
      color: var(--cyber-blue);
      font-size: 1.1rem;
    }

    #terminal-output {
      font-size: 1.1rem;
      line-height: 1.6;
      min-height: 300px;
      white-space: pre-wrap;
      position: relative;
      overflow-y: auto; /* Permitir scroll */
      max-height: 70vh; /* Limitar altura para scroll */
      filter: brightness(1.1) contrast(1.05); /* Efecto CRT sutil */
    }

    #terminal-output::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(rgba(0,0,0,0.05) 50%, transparent 50%);
      background-size: 100% 2px; /* Líneas horizontales */
      pointer-events: none;
    }

    .typing-cursor {
      display: inline-block;
      width: 2px;
      height: 1.2em;
      background: var(--matrix-green);
      margin-left: 2px;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      50.1%, 100% { opacity: 0; }
    }

    /* Alert System */
    #alert-system {
      display: none;
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at center, rgba(255,0,68,0.1) 0%, rgba(0,0,0,0.95) 70%); /* Fondo dinámico */
      z-index: 200;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      will-change: transform, opacity;
    }

    .alert-title {
      font-family: 'Orbitron', monospace;
      font-size: 4rem;
      font-weight: 900;
      color: var(--warning-red);
      text-align: center;
      margin-bottom: 2rem;
      animation: glitchAlert 0.3s infinite;
    }

    @keyframes glitchAlert {
      0% { 
        text-shadow: 2px 0 var(--glitch-pink), -2px 0 var(--cyber-blue);
        transform: translate(0);
      }
      20% { 
        text-shadow: -2px 0 var(--glitch-pink), 2px 0 var(--cyber-blue);
        transform: translate(-2px, 1px);
      }
      40% { 
        text-shadow: 2px 0 var(--glitch-pink), -2px 0 var(--cyber-blue);
        transform: translate(2px, -1px);
      }
      60% { 
        text-shadow: -2px 0 var(--glitch-pink), 2px 0 var(--cyber-blue);
        transform: translate(1px, 2px);
      }
      80% { 
        text-shadow: 2px 0 var(--glitch-pink), -2px 0 var(--cyber-blue);
        transform: translate(-1px, -2px);
      }
      100% { 
        text-shadow: -2px 0 var(--glitch-pink), 2px 0 var(--cyber-blue);
        transform: translate(0);
      }
    }

    .countdown-display {
      font-size: 3rem;
      color: var(--warning-red);
      font-family: 'Orbitron', monospace;
      font-weight: 700;
      text-shadow: 0 0 20px var(--warning-red);
      margin-top: 1rem;
    }

    .hacker-mask {
      width: 200px;
      height: 200px;
      margin: 2rem 0;
      filter: drop-shadow(0 0 20px var(--matrix-green));
      animation: maskFloat 3s ease-in-out infinite;
      will-change: transform, filter;
    }

    @keyframes maskFloat {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-10px) rotate(5deg); }
    }

    .warning-text {
      color: var(--warning-red);
      font-size: 1.5rem;
      text-align: center;
      margin-top: 1rem;
      animation: warningFlash 1s infinite;
    }

    @keyframes warningFlash {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* Final Collapse */
    .collapse-effect {
      animation: collapseShake 0.1s infinite;
    }

    @keyframes collapseShake {
      0% { transform: translate(1px, 1px) rotate(0deg); }
      10% { transform: translate(-1px, -2px) rotate(-1deg); }
      20% { transform: translate(-3px, 0px) rotate(1deg); }
      30% { transform: translate(3px, 2px) rotate(0deg); }
      40% { transform: translate(1px, -1px) rotate(1deg); }
      50% { transform: translate(-1px, 2px) rotate(-1deg); }
      60% { transform: translate(-3px, 1px) rotate(0deg); }
      70% { transform: translate(3px, 1px) rotate(-1deg); }
      80% { transform: translate(-1px, -1px) rotate(1deg); }
      90% { transform: translate(1px, 2px) rotate(0deg); }
      100% { transform: translate(1px, -2px) rotate(-1deg); }
    }

    .final-message {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0,0,0,0.9);
      padding: 15px;
      border: 1px solid var(--matrix-green);
      border-radius: 5px;
      font-size: 0.9rem;
      color: var(--matrix-green);
      max-width: 300px;
      z-index: 300;
      display: none;
      will-change: opacity, transform;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .welcome-title { font-size: 2.5rem; }
      .alert-title { font-size: 2.5rem; }
      .countdown-display { font-size: 2rem; }
      #terminal-output { font-size: 1rem; }
      .hacker-mask { width: 150px; height: 150px; }
    }

    /* Audio Visualization */
    .audio-visualizer {
      position: fixed;
      bottom: 20px;
      left: 20px;
      display: flex;
      align-items: end;
      height: 40px;
      gap: 2px;
      z-index: 300;
      opacity: 1;
      transition: opacity 0.3s ease;
    }

    .audio-bar {
      width: 3px;
      background: var(--matrix-green);
      min-height: 5px;
      animation: audioViz 1s ease-in-out infinite alternate; /* Base animation */
      will-change: height;
    }

    /* Base animation for visualizer bars - will be overridden by JS */
    @keyframes audioViz {
      0% { height: 5px; }
      100% { height: 35px; }
    }

    .glitch-overlay {
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(
        90deg,
        transparent,
        transparent 2px,
        rgba(255,0,128,0.03) 2px,
        rgba(255,0,128,0.03) 4px
      );
      pointer-events: none;
      z-index: 5;
      opacity: 0;
      animation: none; /* Controlled by JS */
      transition: opacity 0.1s ease-out; /* Smooth fade for opacity changes */
      will-change: opacity, transform;
    }

    .glitch-active {
        animation: glitchLines 0.1s infinite, glitchShift 0.05s infinite alternate;
    }

    @keyframes glitchLines {
      0% { opacity: 0; transform: translate(0); }
      10% { opacity: 1; transform: translate(-2px, 1px); }
      20% { opacity: 0; transform: translate(2px, -1px); }
      30% { opacity: 1; transform: translate(-1px, 2px); }
      40% { opacity: 0; transform: translate(1px, -2px); }
      50% { opacity: 1; transform: translate(0); }
      100% { opacity: 0; transform: translate(0); }
    }

    @keyframes glitchShift {
        0% { transform: translate(0, 0); }
        25% { transform: translate(2px, -1px); }
        50% { transform: translate(-1px, 2px); }
        75% { transform: translate(1px, -2px); }
        100% { transform: translate(-2px, 1px); }
    }

    /* SVG Mask Animation */
    .hacker-mask path, .hacker-mask circle {
        stroke-dasharray: 1000;
        stroke-dashoffset: 1000;
        animation: drawMask 3s ease-out forwards;
    }
    .hacker-mask circle { animation-delay: 2.5s; }
    .hacker-mask path:last-child { animation-delay: 3s; }

    @keyframes drawMask {
        to { stroke-dashoffset: 0; }
    }
  </style>
</head>
<body>
  <!-- Custom Cursor -->
  <div class="cursor"></div>
  
  <!-- Matrix Background -->
  <canvas id="matrix"></canvas>
  
  <!-- Scan Line Effect -->
  <div class="scanline"></div>
  <div class="scanline scanline-2"></div>
  
  <!-- Glitch Overlay -->
  <div class="glitch-overlay"></div>
  
  <!-- Audio Visualizer -->
  <div class="audio-visualizer">
    <div class="audio-bar"></div>
    <div class="audio-bar"></div>
    <div class="audio-bar"></div>
    <div class="audio-bar"></div>
    <div class="audio-bar"></div>
  </div>
  
  <!-- Welcome Overlay -->
  <div id="welcome-overlay">
    <div class="welcome-title">🕶️ HR13 SYSTEM ACCESS 🕶️</div>
    <button class="start-btn" id="start-btn">INICIAR SECUENCIA STARLINK</button>
    <div style="margin-top: 2rem; font-size: 0.9rem; color: var(--cyber-blue); text-align: center;">
      ⚠️ ADVERTENCIA: Acceso solo para personal autorizado<br>
      Presiona M para silenciar audio • ESC para salir
    </div>
  </div>
  
  <!-- Main UI Container -->
  <div class="ui-container">
    <!-- Terminal -->
    <div id="terminal-container">
      <div class="terminal-header">
        <div class="terminal-dots">
          <div class="dot red"></div>
          <div class="dot yellow"></div>
          <div class="dot green"></div>
        </div>
        <div class="terminal-title">HR13 TERMINAL v2.1.3 - STARLINK CONNECTION</div>
      </div>
      <div id="terminal-output"></div>
    </div>
  </div>
  
  <!-- Alert System -->
  <div id="alert-system">
    <div class="alert-title">⚠️ SISTEMA COMPROMETIDO ⚠️</div>
    <svg class="hacker-mask" viewBox="0 0 200 200">
      <path d="M100,20 C140,20 180,40 180,80 C180,120 160,140 140,160 C120,180 80,180 60,160 C40,140 20,120 20,80 C20,40 60,20 100,20 Z" fill="none" stroke="var(--matrix-green)" stroke-width="2"/>
      <circle cx="70" cy="80" r="10" fill="var(--warning-red)"/>
      <circle cx="130" cy="80" r="10" fill="var(--warning-red)"/>
      <path d="M70,120 Q100,140 130,120" fill="none" stroke="var(--warning-red)" stroke-width="3"/>
    </svg>
    <div class="countdown-display" id="countdown">Inicializando...</div>
    <div class="warning-text">🔒 Tus datos han sido comprometidos 🔒</div>
  </div>
  
  <!-- Final Message -->
  <div class="final-message" id="final-message">
    <strong>Te hackee o no?</strong><br>
    La ciberseguridad no es un juego.<br>
    Mantén tus sistemas actualizados 🛡️
  </div>
  
  <!-- Audio Elements -->
  <audio id="bgAmbient" loop>
    <source src="https://www.soundjay.com/misc/sounds-378.wav" type="audio/wav">
  </audio>
  
  <script>
    // --- Audio Context and Sound Generation ---
    let audioContext;
    let masterGainNode; // Master gain for overall volume control
    let audioEnabled = true;
    let ambientSource; // To control ambient sound

    // Initialize audio context and master gain
    function initAudio() {
      if (audioContext) return; // Prevent re-initialization
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      masterGainNode = audioContext.createGain();
      masterGainNode.connect(audioContext.destination);
      masterGainNode.gain.setValueAtTime(audioEnabled ? 1 : 0, audioContext.currentTime); // Initial volume
    }

    // Play synth beep (more versatile)
    function playBeep(frequency = 800, duration = 100, volume = 0.1, type = 'square', attack = 0.01, decay = 0.05) {
      if (!audioEnabled || !audioContext) return;

      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.connect(gainNode);
      gainNode.connect(masterGainNode); // Connect to master gain

      oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
      oscillator.type = type;

      gainNode.gain.setValueAtTime(0, audioContext.currentTime);
      gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + attack);
      gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + attack + decay);

      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + duration / 1000);
    }

    // Play a more complex alarm sound
    function playAlarm() {
      if (!audioEnabled || !audioContext) return;

      const alarmDuration = 5000; // 5 seconds alarm
      const beepInterval = 400; // ms between beeps
      let startTime = audioContext.currentTime;

      const alarmLoop = setInterval(() => {
        if (audioContext.currentTime - startTime > alarmDuration) {
          clearInterval(alarmLoop);
          return;
        }
        playBeep(1200, 150, 0.2, 'sawtooth'); // Higher pitch, sawtooth for urgency
        setTimeout(() => playBeep(800, 150, 0.2, 'sawtooth'), 200); // Lower pitch
      }, beepInterval);
    }

    // Play a glitch sound effect
    function playGlitchSound() {
        if (!audioEnabled || !audioContext) return;
        const bufferSize = audioContext.sampleRate * 0.1; // 0.1 seconds of noise
        const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
        const output = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
            output[i] = Math.random() * 2 - 1; // White noise
        }

        const source = audioContext.createBufferSource();
        source.buffer = buffer;
        const gainNode = audioContext.createGain();
        gainNode.gain.setValueAtTime(0.05 + Math.random() * 0.05, audioContext.currentTime); // Random volume
        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.08); // Quick decay

        source.connect(gainNode);
        gainNode.connect(masterGainNode);
        source.start();
    }

    // --- Custom Cursor ---
    const cursor = document.querySelector('.cursor');
    document.addEventListener('mousemove', (e) => {
      requestAnimationFrame(() => { // Use requestAnimationFrame for smooth cursor movement
        cursor.style.left = e.clientX + 'px';
        cursor.style.top = e.clientY + 'px';
      });
    });

    // --- Matrix Rain Effect ---
    const canvas = document.getElementById('matrix');
    const ctx = canvas.getContext('2d');
    
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    const letters = 'アァイィウヴエェオカガキギクグケゲコゴサザシジスズセゼソゾタダチヂツヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミムメモヤユヨラリルレロワンHR13010110'.split('');
    const fontSize = 14;
    const columns = canvas.width / fontSize;
    const drops = Array(Math.floor(columns)).fill(1);
    
    function drawMatrix() {
      requestAnimationFrame(drawMatrix); // Use requestAnimationFrame
      ctx.fillStyle = 'rgba(0, 0, 8, 0.05)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      ctx.fillStyle = '#00ff41';
      ctx.font = fontSize + 'px monospace';
      
      for (let i = 0; i < drops.length; i++) {
        const text = letters[Math.floor(Math.random() * letters.length)];
        ctx.fillText(text, i * fontSize, drops[i] * fontSize);
        
        // Vary drop speed and reset condition
        if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
          drops[i] = 0;
        } else {
          drops[i] += (Math.random() * 0.5) + 0.5; // Vary speed slightly
        }
      }
    }
    drawMatrix(); // Start the matrix animation

    // Window resize handler
    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      // Re-initialize drops array for new column count
      const newColumns = canvas.width / fontSize;
      drops.length = Math.floor(newColumns);
      drops.fill(1);
    });
    
    // --- Main Sequence Elements ---
    const welcomeOverlay = document.getElementById('welcome-overlay');
    const startBtn = document.getElementById('start-btn');
    const terminalContainer = document.getElementById('terminal-container');
    const terminalOutput = document.getElementById('terminal-output');
    const alertSystem = document.getElementById('alert-system');
    const countdown = document.getElementById('countdown');
    const finalMessage = document.getElementById('final-message');
    const glitchOverlay = document.querySelector('.glitch-overlay');
    const bgAmbient = document.getElementById('bgAmbient');
    const audioVisualizerBars = document.querySelectorAll('.audio-bar');

    // MODIFICACIÓN: Secuencia de hackeo más concisa
    const hackingSequence = [
      '> 🛰 Conectando al servidor!!!',
      '> 📡 Autentificando usuario!!!',
      '> ✅ ¡¡¡ACCESO CONCEDIDO!!!',
      '> 👨🏻‍💻 Analizando sistema…',
      '> 🖲 Detectando vulnerabilidad…',
      '> 📊 Accediendo a base de datos...',
      '> 📑 Descargando archivos...',
      '> ⚠️ ERROR: Sistema señuelo',
      '> 🚨 CONTRAATAQUE ACTIVADO',
      '> 💀🏴‍☠️ ¡¡¡HACKEO INICIADO!!!',
      '> 🦠 Instalando backdoor...',
      '> 📍 IP rastreada...',
      '> 🏴‍☠️🔐 HR13 ha tomado el control!!!',
      '> 📴 NO desconectar...',
      '> 🗂 Archivos encriptados...',
      '> Sistema: COMPROMETIDO 💀☠️👻'
    ];
    
    let currentStep = 0;
    let isTyping = false;
    
    // --- Keyboard Shortcuts ---
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        window.location.href = 'about:blank'; // Exit
      }
      if (e.key.toLowerCase() === 'm') {
        audioEnabled = !audioEnabled;
        masterGainNode.gain.setValueAtTime(audioEnabled ? 1 : 0, audioContext.currentTime);
        const visualizer = document.querySelector('.audio-visualizer');
        visualizer.style.opacity = audioEnabled ? '1' : '0.3';
      }
    });
    
    // --- Start Button Handler ---
    startBtn.addEventListener('click', async () => {
      initAudio(); // Initialize audio context on user interaction
      bgAmbient.volume = 0.1;
      // Iniciar la reproducción del audio ambiental de forma segura
      bgAmbient.play().then(() => {
        console.log("Audio ambiental iniciado.");
      }).catch(error => {
        console.error("Error al iniciar audio ambiental:", error);
        // Opcional: Mostrar un mensaje al usuario si el audio no se puede reproducir
      });
      setupAudioVisualizer(); // Setup visualizer after audio context is ready

      welcomeOverlay.style.display = 'none';
      terminalContainer.style.display = 'block';
      
      playBeep(1000, 200, 0.2); // Initial beep
      await typeSequence();
    });
    
    // --- Typewriter Effect ---
    async function typeText(text, speed = 40) {
      return new Promise(resolve => {
        isTyping = true;
        let i = 0;
        
        const typeChar = () => {
          if (i < text.length) {
            terminalOutput.textContent += text.charAt(i);
            terminalOutput.scrollTop = terminalOutput.scrollHeight; // Auto-scroll

            // Vary beep sound for typing effect
            if (i % 2 === 0) playBeep(600 + Math.random() * 200, 30, 0.03, 'sine', 0.005, 0.02);
            
            i++;
            requestAnimationFrame(() => setTimeout(typeChar, speed + Math.random() * 20)); // Use RAF for typing
          } else {
            terminalOutput.textContent += '\n';
            isTyping = false;
            resolve();
          }
        };
        typeChar();
      });
    }
    
    // --- Main Hacking Sequence ---
    async function typeSequence() {
      for (let i = 0; i < hackingSequence.length; i++) {
        await typeText(hackingSequence[i], 40);
        
        // MODIFICACIÓN: Ajuste de los índices para los eventos de sonido/glitch
        if (i === 2) { // ¡¡¡ACCESO CONCEDIDO!!!
            playBeep(1500, 300, 0.3, 'sine');
            await new Promise(resolve => setTimeout(resolve, 800));
        } else if (i === 5) { // Vulnerabilidades: 13
            playBeep(1200, 300, 0.15);
        } else if (i === 10) { // ⚠️ ERROR: Sistema señuelo
            playBeep(200, 500, 0.4, 'triangle'); // Low, long tone for error
            glitchOverlay.classList.add('glitch-active');
            glitchOverlay.style.opacity = '0.5';
            playGlitchSound();
            await new Promise(resolve => setTimeout(resolve, 1000));
        } else if (i === 11) { // 🚨 CONTRAATAQUE ACTIVADO
            playBeep(1800, 400, 0.3, 'sawtooth'); // High, sharp tone
            glitchOverlay.classList.add('glitch-active');
            glitchOverlay.style.opacity = '0.8';
            playGlitchSound();
            await new Promise(resolve => setTimeout(resolve, 1000));
        } else if (i === 16) { // 🏴‍☠️ HR13 tomó control
            playBeep(100, 600, 0.5, 'square'); // Deep, ominous tone
            glitchOverlay.classList.add('glitch-active');
            glitchOverlay.style.opacity = '1';
            playGlitchSound();
            await new Promise(resolve => setTimeout(resolve, 1000));
        } else if (i >= 14) { // General glitching during reverse hack (ajustado el inicio)
            glitchOverlay.classList.add('glitch-active');
            glitchOverlay.style.opacity = '0.3';
            if (Math.random() < 0.5) playGlitchSound();
        } else {
            glitchOverlay.classList.remove('glitch-active');
            glitchOverlay.style.opacity = '0';
        }
        
        await new Promise(resolve => setTimeout(resolve, 300 + Math.random() * 500));
        
        if (i === hackingSequence.length - 1) {
          setTimeout(showAlert, 1500);
        }
      }
    }
    
    // --- Show Alert System ---
    function showAlert() {
      terminalContainer.style.display = 'none';
      alertSystem.style.display = 'flex';
      document.body.classList.add('collapse-effect');
      glitchOverlay.classList.remove('glitch-active'); // Remove continuous glitch
      glitchOverlay.style.opacity = '0'; // Reset glitch overlay

      playAlarm(); // Start alarm sound
      startCountdown(15);
    }
    
    // --- Countdown ---
    function startCountdown(seconds) {
      let count = seconds;
      countdown.textContent = `Colapso del sistema en: ${count}`;
      
      const interval = setInterval(() => {
        count--;
        countdown.textContent = `Colapso del sistema en: ${count}`;
        playBeep(1500, 100, 0.1); // Countdown beep

        if (count === 5) {
          document.body.style.filter = 'hue-rotate(180deg) contrast(1.5)'; // Visual distortion
        }
        
        if (count <= 0) {
          clearInterval(interval);
          finalCollapse();
        }
      }, 1000);
    }
    
    // --- Final Collapse ---
    function finalCollapse() {
      countdown.textContent = '💥💣 ¡SISTEMA DESTRUIDO!';
      
      // Enhanced visual effects
      document.body.style.background = 'radial-gradient(circle, #ff0000, #000000)';
      glitchOverlay.classList.add('glitch-active');
      glitchOverlay.style.opacity = '0.8';
      
      // Intense audio feedback
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          playBeep(200 - i * 20, 500, 0.2, 'square'); // Descending tones
        }, i * 200);
      }
      playGlitchSound(); // Final glitch sound

      setTimeout(() => {
        document.body.classList.remove('collapse-effect');
        finalMessage.style.display = 'block';
        finalMessage.innerHTML = '<strong>Te hackee o no?</strong><br>La ciberseguridad 🔐 no es un juego.<br> 🤡'; // MODIFICACIÓN: Texto final
        glitchOverlay.classList.remove('glitch-active');
        glitchOverlay.style.opacity = '0';
        masterGainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 1); // Fade out all audio

        setTimeout(() => {
          window.location.href = 'https://hr13hacked.com/404'; // Redirect
        }, 5000);
      }, 3000);
    }
    
    // --- Audio Visualizer Setup ---
    function setupAudioVisualizer() {
        if (!audioContext) return;

        const analyser = audioContext.createAnalyser();
        analyser.fftSize = 256; // Smaller size for faster updates
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);

        // Connect master gain to analyser
        masterGainNode.connect(analyser);
        analyser.connect(audioContext.destination); // Analyser must connect to destination too

        function drawVisualizer() {
            requestAnimationFrame(drawVisualizer);
            analyser.getByteFrequencyData(dataArray);

            // Map frequency data to bar heights
            for (let i = 0; i < audioVisualizerBars.length; i++) {
                const bar = audioVisualizerBars[i];
                // Take a sample from the lower frequencies, adjust index for more variation
                const value = dataArray[i * 5 + 10] / 255; // Adjust multiplier for sensitivity
                bar.style.height = `${5 + value * 30}px`; // Min height 5px, max 35px
            }
        }
        drawVisualizer();
    }

    // --- Ambient Sound Control ---
    // The ambient sound will start playing on the first user interaction (start button click)
    // Its volume is controlled by masterGainNode.
  </script>
</body>
</html>
```
